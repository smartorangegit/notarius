<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<?php
header('Cache-Control: no cache');
mb_internal_encoding("UTF-8");
$param = App::getRouter()->getParams();
$log = $data['user']['login'];
if(!$param){
?>
<h3 class="section-heading">Таблица со списком нотариусов</h3>
<div class="limiter queries_margin_top">
        <div class="container-table100">
            <div class="wrap-table100">

                <div class="table100 ver6 m-b-110">
                    <table data-vertable="ver6">
                        <thead>
                            <tr class="row100 head">
                                <th class="column100 column1 user-list-th" data-column="column2">ФИО</th>
                                <th class="column100 column2 user-list-th" data-column="column3">Телефон мобильный</th>
                                <th class="column100 column3 user-list-th" data-column="column4">Район</th>
                                <th class="column100 column4 user-list-th" data-column="column5">Улица</th>
                                <th class="column100 column5 user-list-th" data-column="column2">Дом</th>
                                <th class="column100 column6 user-list-th" data-column="column3">Подьезд</th>
                                <th class="column100 column7 user-list-th" data-column="column4">Этаж</th>
                                <th class="column100 column8 user-list-th" data-column="column5">Номер квартиры/помещения</th>
                                <th class="column100 column9 user-list-th" data-column="column5">Код домофона</th>
                                <th class="column100 column10 user-list-th" data-column="column2">Метро</th>
                                <th class="column100 column11 user-list-th" data-column="column3">Название масива</th>
                                <th class="column100 column12 user-list-th" data-column="column4">Работает в суботу</th>
                                <th class="column100 column13 user-list-th" data-column="column5">Работает в воскресенье</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach($data['list1'] as $item) {
                            if($item['role'] == 'notary'){?>
                            <tr class="row100">
                                <td class="column100 column1 user-list-td user-list-col-1" data-column="column1">
                                    <?=$item['fName'].' '.$item['sName'].' '.$item['mName']?>
                                </td>

                                <td class="column100 column2 user-list-td user-list-col-2" data-column="column2">
                                    <a href="/admin/users/list_notary/<?=$item['id'];?>"><?=$item['login']?></a>
                                </td>

                                <td class="column100 column3 user-list-td user-list-col-3" data-column="column3">
                                   <?=$item['area']?>
                                </td>

                                <td class="column100 column4 user-list-td" data-column="column4">
                                    <?=$item['street']?>
                                </td>

                                <td class="column100 column5 user-list-td user-list-col-5" data-column="column1">
                                    <?=$item['house']?>
                                </td>

                                <td class="column100 column6 user-list-td" data-column="column2">
                                    <?=$item['entrance']?>
                                </td>

                                <td class="column100 column7 user-list-td" data-column="column3">
                                    <?=$item['floor']?>
                                </td>

                                <td class="column100 column7 user-list-td" data-column="column3">
                                    <?=$item['room']?>
                                </td>

                                <td class="column100 column8 user-list-td" data-column="column4">
                                    <?=$item['doorphoneCode']?>
                                </td>

                                <td class="column100 column10 user-list-td user-list-col-5" data-column="column1">
                                    <?=$item['metroName']?>
                                </td>

                                <td class="column100 column11 user-list-td" data-column="column2">
                                    <?=$item['mAreaName']?>
                                </td>

                                <td class="column100 column12 user-list-td" data-column="column3">
                                    <?if($item['wSaturday']==0){echo "Нет";}elseif($item['wSaturday']==1){echo "Да";}?>
                                </td>

                                <td class="column100 column13 user-list-td" data-column="column4">
                                    <?if($item['wSunday']==0){echo "Нет";}elseif($item['wSunday']==1){echo "Да";}?>
                                </td>

                            </tr>
                           <?php }
                             } ?>
                        </tbody>
                    </table>
                </div>
                
            </div>
        </div>
    </div>

<?
}
else{
?>
<div>
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4>Информация по нотариусу</h4>
            
        </div>
        <div class="panel-body">
            <form action="" method="post">
                <input type="hidden" value="1" name="updNotaryInfo">
                <!--<div class="form-group col-sm-4">-->
                    <!--<label id="userID">userID</label>-->
                    <!--<input type="text" class="form-control" name="userID" value="<?=$data['user']['userID'];?>">-->
                <!--</div>-->
                <div class="form-group col-sm-4">
                    <label id="login">Логин</label>
                    <input type="text" class="form-control" name="login" value="<?=$data['user']['login'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="email">Имейл</label>
                    <input type="text" class="form-control" name="email" value="<?=$data['user']['email'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="fName">Имя</label>
                    <input type="text" class="form-control" name="fName" value="<?=$data['user']['fName'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="sName">Фамилия</label>
                    <input type="text" class="form-control" name="sName" value="<?=$data['user']['sName'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="mName">Отчество</label>
                    <input type="text" class="form-control" name="mName" value="<?=$data['user']['mName'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="sex">Пол</label>
                    <input type="text" class="form-control" name="sex" value="<?=$data['user']['sex'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="license">Номер лицензии</label>
                    <input type="text" class="form-control" name="license" value="<?=$data['user']['license'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="dateOfRegLicense">Дата регистрации лицензии</label>
                    <input type="text" class="form-control" name="dateOfRegLicense" value="<?=$data['user']['dateOfRegLicense'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="aboutNotary">Описание к нотириусу</label>
                    <input type="text" class="form-control" name="aboutNotary" value="<?=$data['user']['aboutNotary'];?>">
                </div>
                <!--<div class="form-group col-sm-4">-->
                    <!--<label id="role">role</label>-->
                    <!--<input type="text" class="form-control" name="role" value="<?=$data['user']['role'];?>">-->
                <!--</div>-->
                <!--<div class="form-group col-sm-4">-->
                    <!--<label id="password">Пароль (поле для изменения)</label>-->
                    <!--<input type="text" class="form-control" name="password" value="<?=$data['user']['password'];?>">-->
                <!--</div>-->
                <!--<div class="form-group col-sm-4">-->
                    <!--<label id="token">token</label>-->
                    <!--<input type="text" class="form-control" name="token" value="<?=$data['user']['token'];?>">-->
                <!--</div>-->
                <div class="form-group col-sm-4">
                    <label id="is_active">Прошел верификацию сервиса</label>
                    <input type="text" class="form-control" name="is_active" value="<?=$data['user']['is_active'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="city">Город</label>
                    <!--<input type="text" class="form-control" name="city" value="<?=$data['user']['city'];?>">-->
                    <select class="form-control" name="city" id="mySelect" onchange="myFunction()" data-city="<?=$data['user']['city']?>" >
                        <?foreach($data['location'] as $loctar){?>
                        <option  value="<?=$loctar['id'];?>"><?=$loctar['cityName']?></option>
                        <?}?>
                    </select>
                </div>
                <div class="form-group col-sm-4">
                    <label for="metro">Метро</label>
                    <select name="metro" class="form-control" id="metro" data-metro="<?=$data['user']['metro']?>">
                        <option value="<?=$data['user']['metro'];?>"><?=$data['user']['metro'];?></option>
                    </select>
                </div>
                <div class="form-group col-sm-4">
                    <label for="area" >Район</label>
                    <select id="area" name="area" class="form-control" data-area="<?=$data['user']['area']?>">
                        <option value="<?=$data['user']['area'];?>"><?=$data['user']['area'];?></option>
                    </select>
                </div>
                <div class="form-group col-sm-4">
                    <label for="arrayName">Жилой массив</label>
                    <select name="arrayName" class="form-control" id="arrayName" data-marray="<?=$data['user']['arrayName']?>">
                        <option value="<?=$data['user']['arrayName'];?>"><?=$data['user']['arrayName'];?></option>
                    </select>
                </div>
                <div class="form-group col-sm-4">
                    <label id="street">Улица</label>
                    <input type="text" class="form-control" name="street" value="<?=$data['user']['street'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="house">Дом</label>
                    <input type="text" class="form-control" name="house" value="<?=$data['user']['house'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="entrance">Подъезд</label>
                    <input type="text" class="form-control" name="entrance" value="<?=$data['user']['entrance'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="floor">Этаж</label>
                    <input type="text" class="form-control" name="floor" value="<?=$data['user']['floor'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="room">Квартира</label>
                    <input type="text" class="form-control" name="room" value="<?=$data['user']['room'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="doorphoneCode">Код домофона</label>
                    <input type="text" class="form-control" name="doorphoneCode" value="<?=$data['user']['doorphoneCode'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="typeOfNotary">Частный/Государственный</label>
                    <input type="text" class="form-control" name="typeOfNotary" value="<?=$data['user']['typeOfNotary'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="geolocation">Гео координаты</label>
                    <input type="text" class="form-control" name="geolocation" id="coords" value="<?=$data['user']['geolocation'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="offiePhoto">Ссылка на фото офиса</label>
                    <input type="text" class="form-control" name="offiePhoto" value="<?=$data['user']['offiePhoto'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="poweredByExit">Выезжает ли на дом ?</label>
                    <input type="text" class="form-control" name="poweredByExit" value="<?=$data['user']['poweredByExit'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="stWeekday">Начало работы в будни</label>
                    <input type="text" class="form-control" name="stWeekday" value="<?=$data['user']['stWeekday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="etWeekday">Конец работы в будни</label>
                    <input type="text" class="form-control" name="etWeekday" value="<?=$data['user']['etWeekday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="wSaturday">Работает ли в субботу ?</label>
                    <input type="text" class="form-control" name="wSaturday" value="<?=$data['user']['wSaturday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="wSunday">Работает ли в воскресенье ?</label>
                    <input type="text" class="form-control" name="wSunday" value="<?=$data['user']['wSunday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="wHolidays">Работает ли в праздники ?</label>
                    <input type="text" class="form-control" name="wHolidays" value="<?=$data['user']['wHolidays'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="stSaturday">Начало работы в субботу</label>
                    <input type="text" class="form-control" name="stSaturday" value="<?=$data['user']['stSaturday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="etSaturday">Конец работы в субботу</label>
                    <input type="text" class="form-control" name="etSaturday" value="<?=$data['user']['etSaturday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="stSunday">Начало работы в воскресенье</label>
                    <input type="text" class="form-control" name="stSunday" value="<?=$data['user']['stSunday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="etSunday">Конец работы в воскресенье</label>
                    <input type="text" class="form-control" name="etSunday" value="<?=$data['user']['etSunday'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="stHolidays">Начало работы в праздники</label>
                    <input type="text" class="form-control" name="stHolidays" value="<?=$data['user']['stHolidays'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="etHolidays">Конец работы в праздники</label>
                    <input type="text" class="form-control" name="etHolidays" value="<?=$data['user']['etHolidays'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="cityPhone">Городской номер</label>
                    <input type="text" class="form-control" name="cityPhone" value="<?=$data['user']['cityPhone'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="nameOfAssistant">ФИО помощника</label>
                    <input type="text" class="form-control" name="nameOfAssistant" value="<?=$data['user']['nameOfAssistant'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="assistantPhone">Номер помощника</label>
                    <input type="text" class="form-control" name="assistantPhone" value="<?=$data['user']['assistantPhone'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="emailAssistant">Имейл помощника</label>
                    <input type="text" class="form-control" name="emailAssistant" value="<?=$data['user']['emailAssistant'];?>">
                </div>
                <div class="form-group col-sm-4">
                    <label id="video">Код видео</label>
                    <input type="text" class="form-control" name="video" value="<?=$data['user']['video'];?>">
                </div>
                <div class="form-group col-sm-12">
                    <input type="submit" value="Редактировать" class="btn btn-primary">
                </div>
            </form>
        </div>
    </div>
    <?
    $massCoords = explode(',',$data['user']['geolocation']);
    $notaryCoords = json_encode($massCoords);
    ?>
<div >
    <input id="searchInput" class="controls" type="text" placeholder="Enter a location">
    <div id="map" style="width: 100%; height: 500px;"></div>
    <script>
        function initMap() {
            var obj = JSON.parse('<?print_r($notaryCoords)?>');
            var myLatlng = new google.maps.LatLng(obj[0], obj[1]);
            var map = new google.maps.Map(document.getElementById('map'), {
                center: myLatlng,
                zoom: 13
            });
            var input = document.getElementById('searchInput');
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

            var autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.bindTo('bounds', map);

            var infowindow = new google.maps.InfoWindow();
            var marker = new google.maps.Marker({
                map: map,
                draggable:true,
                anchorPoint: new google.maps.Point(0, -29),
                position: myLatlng
            });

            autocomplete.addListener('place_changed', function() {
                infowindow.close();
                marker.setVisible(false);
                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    window.alert("Autocomplete's returned place contains no geometry");
                    return;
                }

                // If the place has a geometry, then present it on a map.
                if (place.geometry.viewport) {
                    map.fitBounds(place.geometry.viewport);
                } else {
                    map.setCenter(place.geometry.location);
                    map.setZoom(17);
                }
                marker.setIcon(({
                    url: place.icon,
                    size: new google.maps.Size(71, 71),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(17, 34),
                    scaledSize: new google.maps.Size(35, 35)
                }));
                marker.setPosition(place.geometry.location);
                marker.setVisible(true);

                var address = '';
                if (place.address_components) {
                    address = [
                        (place.address_components[0] && place.address_components[0].short_name || ''),
                        (place.address_components[1] && place.address_components[1].short_name || ''),
                        (place.address_components[2] && place.address_components[2].short_name || '')
                    ].join(' ');
                }

                infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
                infowindow.open(map, marker);

                //Location details
                for (var i = 0; i < place.address_components.length; i++) {
                    if(place.address_components[i].types[0] == 'postal_code'){
                        document.getElementById('postal_code').innerHTML = place.address_components[i].long_name;
                    }
                    if(place.address_components[i].types[0] == 'country'){
                        document.getElementById('country').innerHTML = place.address_components[i].long_name;
                    }
                }
                document.getElementById('location').innerHTML = place.formatted_address;
                document.getElementById('lat').innerHTML = place.geometry.location.lat();
                document.getElementById('lon').innerHTML = place.geometry.location.lng();

                marker.addListener('drag', function() {
                    var lat = marker.getPosition().lat();
                    var lng = marker.getPosition().lng();
                    var x = document.getElementById('coords');
                    x.setAttribute("value", lat + ',' + lng);
                    document.getElementById('lat').innerHTML = lat;
                    document.getElementById('lon').innerHTML = lng;
                });
                var lat = marker.getPosition().lat();
                var lng = marker.getPosition().lng();
                var x = document.getElementById('coords');
                x.setAttribute("value", lat + ',' + lng);


            });
        }
    </script>
    <script>
        function myFunction() {
            var metro = document.getElementById('metro');
            var areaName = document.getElementById('area');
            var mAreaName = document.getElementById('arrayName');
            var xz = document.getElementById("mySelect").value;
            var promise = {
                'id'  : xz
            };
            $.ajax({
                url: '/webroot/getLoc.php',
                type: "POST",
                data: promise,
                success: function(data)
                {   
                    var parseData = JSON.parse(data)
                    console.log(parseData);
                    fillInputs(parseData.metro, 'metro', metro);
                    fillInputs(parseData.areas, 'area', areaName);
                    fillInputs(parseData.mAreas, 'mArea', mAreaName);

                }
            });

            function fillInputs(arr, name, input) {
                var option = arr.reduce(function(final, cur) {
                    return final+='<option value="'+ cur[name + 'ID'] +'">' + cur[name + 'Name']  + '</option>'
                },'');
                input.innerHTML = option;
            }

        }

        var city = document.getElementById("mySelect");
        city.selectedIndex = city.dataset.city;


        $( document ).ready(function() {
           myFunction();
            setTimeout(func, 1000);
        });

        function func() {
            var metro = document.getElementById("metro");
            //metro.selectedIndex = 4;
            metro.value = metro.dataset.metro;

            var area = document.getElementById("area");
            //area.selectedIndex = area.dataset.area;
            //console.log(area.dataset.area);
            area.value = area.dataset.area;

            var arrayName = document.getElementById("arrayName");
            //arrayName.selectedIndex = arrayName.dataset.marray;
            //console.log(arrayName.dataset.marray);
            arrayName.value = arrayName.dataset.marray;

        }

    </script>
        <div class="row" style="margin-top:25px;    ">
            <div class="col-sm-4">
                <div>
    <?
        $dir = ROOT.DS.'webroot/uploads/'.$log.'/';
        $files = scandir($dir,1);

        $dir2 = ROOT.DS.'webroot/uploads/'.$log.'/photo/';
        $files2 = scandir($dir2,1);

        $countFiles = count($files)-2;
        if(!empty($files2[0])){
    ?>
                    <embed src="/webroot/uploads/<?=$log.'/photo/'.$files2[0];?>" width="200" height="255">
                        <?}?>
                </div>
                <div class="col-sm-12">
                    <h5>Загрузка изоражения профиля</h5>
                    <form action="" method="post" enctype="multipart/form-data" class="fallback">
                        <div class="form-group">
                            <input id="profil" name="image" type="file">
                        </div>
                        <div class="form-group">
                            <input class="btn" type="submit">
                        </div>
                        <input name="profilePhoto" type="hidden" value="1">
                    </form>
                </div>
                <div class="col-sm-12" style="margin-top: 25px;">
                    <ul id="geoData" class="list-group">
                        <li class="list-group-item">Full Address: <span id="location"></span></li>
                        <li class="list-group-item">Postal Code: <span id="postal_code"></span></li>
                        <li class="list-group-item">Country: <span id="country"></span></li>
                        <li class="list-group-item">Latitude: <span id="lat"></span></li>
                        <li class="list-group-item">Longitude: <span id="lon"></span></li>
                    </ul>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="col-sm-12">
                    <div class="embed-responsive embed-responsive-16by9">
                            <iframe width="560" height="315" class="embed-responsive-item"
                            src="https://www.youtube.com/embed/<?=$data['user']['video'];?>"
                            frameborder="0">
                            </iframe>
                    </div>
                </div>
            </div>
    </div>
    <div class="col-sm-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h5>Загрузка документов</h5>
            </div>
            <div class="panel-body">
                <form action="" method="post" enctype="multipart/form-data" class="fallback">
                    <div class="form-group">
                        <input id="image" name="image[]" type="file" multiple="">
                    </div>
                    <div class="form-group">
                        <input class="btn" type="submit">
                    </div>
                </form>
                
        
                <?
        for($i=0;$i<$countFiles;$i++){
        if(is_dir($dir.$files[$i])){
            //echo 'dir';
        }else{
        ?>
        
            <div class="col-xs-6 col-md-3">
                <a href="/webroot/uploads/<?=$log.'/'.$files[$i];?>" target="_blank" class="thumbnail">
                    <embed src="/webroot/uploads/<?=$log.'/'.$files[$i];?>">
                    <form action="" method="post">
                        <input type="hidden" value="<?=$files[$i];?>" name="dellName">
                        <input type='submit' class="btn btn-danger" value="Удалить">
                        <input type="button" class="btn btn-primary" value="Просмотреть">
                    </form>
                </a>
            </div>
            </div>
        </div>
        
    </div>

                <?}}?>
                
            <div class="col-sm-12">
                <form action="" method="post">
                    <div class="form-group">
                        <label>Список всех услуг</label>
                        <select class="form-control" size="5"  name="addServNotary">
                            <?foreach($data['getListServices'] as $itemC){?>
                            <option value="<?=$itemC['id']?>"><?=$itemC['name']?></option>
                            <?}?>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-success">Добавить</button>
                    </div>
                </form>
                <form action="" method="post">
                    <table class="table table-striped table-bordered" >
                        <thead>
                            <tr>
                                <th>Название</th>
                                <th>Цена услуги</th>
                                <th>Цена доп услуг</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                        <?php
                        //print_r($data['getListServicesIn']);
                            foreach($data['getListServicesIn'] as $item) {
                        $costs = explode(',',$item['costAService']);
                        $ctn = count($costs);
                        $sum = 0;
                        for($i=0;$i<=$ctn;$i++){
                            $sum = $sum+$costs[$i];
                        }
                        ?>
                            <tr>
                                <td><a href="/notary/users/services/<?=$item['id']?>"><?=$item['name']?></a></td>
                                <td><?=$item['costService']?></td>
                                <td><?=$sum;?></td>
                                <td><button type="submit" class="btn btn-danger" name="dellID" value="<?=$item['idDell']?>">Очистить</button></td>
                            </tr>
                            <?php } ?>
                        </tbody>
                    </table>
                </form>
            </div>
</div>
</div>

<?}
?>

